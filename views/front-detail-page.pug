extends layout/layout-front

block css
    link(href="/css/detailPage.css",rel="stylesheet")
block content
    input(id="content",type="hidden",value=topic._id)
    .detailPage
        .detail
            .title
                img(src="/img/medium-logo.png" alt="")
                div
                    p 君银天财会
                    p #{moment(topic.meta.updateAt).format('HH:MM')}
            .content !{topic.content}
            .sub
                span.fa.fa-thumbs-o-up#detail_thumb
                p: span#detail_num #{topic.praise}
        .hot-comments
            .title 热门评论
            .comments
                ul
                    if(hotComments && hotComments.length > 0)
                        each item in hotComments
                            li
                                .box
                                    .user-img: img(src="/img/was/user.jpg" alt="")
                                    .info
                                        p.name-box
                                            span.name KKKKKKK线
                                            span.right
                                                a
                                                    span.fa.fa-thumbs-o-up
                                                    span.num 0
                                                a.please
                                                    span.fa.fa-commenting-o
                                                    span.num 2
                                        p.time 2017-07-14 14:33
                                        p.comment 可以进去抄底了吗，老师
                                        .next-comment
                                            p
                                                span.name 董齐安
                                                |:
                                                span 先看小幅反抽。
                                            p
                                                span.name 董齐安
                                                |:
                                                span 先看小幅反抽。
                                            .up-arrow
        .all-comments
            .title
                |全部评论(
                span 16
                |)
            .comments
                ul
                    if(allComments && allComments.length > 0)
                        each item in allComments
                            li
                                .box
                                    .user-img: img(src="/img/was/user.jpg" alt="")
                                    .info
                                        p.name-box
                                            span.name KKKKKKK线
                                            span.right
                                                a
                                                    span.fa.fa-thumbs-o-up
                                                    span.num 0
                                                a.please
                                                    span.fa.fa-commenting-o
                                                    span.num 2
                                        p.time 2017-07-14 14:33
                                        p.comment 可以进去抄底了吗，老师
                                        .next-comment
                                            p
                                                span.name 董齐安
                                                | :
                                                span 先看小幅反抽。
                                            p
                                                span.name 董齐安
                                                | :
                                                span 先看小幅反抽。
                                            .up-arrow
        .input-comment
            input(id="comment" type="text" placeholder="在这里发表评论")
            a.fa.fa-comment#detail_comment



block script
    script.
        $(function(){
          /**点赞**/
          $('#detail_thumb').on('click',function(){
            $.ajax({
              url:'/topic/praise/'+'#{topic._id}',
              success:function(data){
                if(data.state==='success'){
                  $('#detail_num').html(function(index,value){
                    return parseInt(value)+1
                  })
                }
              },
              error:function(err){
                console.log(err);
              }
            })
          })

          /**评论**/
          $('#detail_comment').on('click',function(){
            var content = $('#comment').val();
            $.ajax({
              method:'POST',
              url:'/comment/new/',
              data:{
                topic:'#{topic._id}',
                content:content
              },
              success:function(data){
                if(data.state==='success'){
                  console.log(data.comment)
                }
              },
              error:function(err){
                console.log(err)
              }
            })
          })

        })

